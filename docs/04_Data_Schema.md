# ğŸ’¾ 04_Data_Schema.md (æ•°æ®ç»“æ„è§„èŒƒ)

**é€‚ç”¨èŒƒå›´ï¼š** åç«¯ API, AI æ¨¡å‹è¾“å‡º, å‰ç«¯ Store
**æ ¸å¿ƒç›®æ ‡ï¼š** æä¾›ç»“æ„åŒ–çš„æ–‡æœ¬å…ƒæ•°æ®ï¼Œæ”¯æ’‘ v2.1 çš„åŠ¨æ€æ¸²æŸ“éœ€æ±‚ã€‚

---

## 1. æ ¸å¿ƒå®ä½“å…³ç³» (Entity Relationship)

*   **Text (Book/Article)**: é¡¶å±‚å®¹å™¨ï¼ŒåŒ…å«å…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€ä½œè€…ã€ç­‰çº§ç­‰ï¼‰ã€‚
*   **Sentence (Paragraph)**: æ•°æ®åº“å­˜å‚¨çš„åŸºæœ¬å•ä½ã€‚åœ¨ UI ä¸­é€šå¸¸è¡¨ç°ä¸ºä¸€ä¸ªå¯äº¤äº’çš„æ®µè½ã€‚
    *   `content`: åŸå§‹è‹±æ–‡æ–‡æœ¬ã€‚
    *   `translation`: å¯¹åº”ä¸­æ–‡ç¿»è¯‘ã€‚
    *   `analysis`: æ ¸å¿ƒ JSON å­—æ®µï¼ŒåŒ…å« AI ç”Ÿæˆçš„è„šæ‰‹æ¶æ•°æ®ã€‚

---

## 2. å¥å­åˆ†æå¯¹è±¡ (Sentence Analysis Object)

ä½äº `Sentence.analysis` ä¸­çš„ JSON å¯¹è±¡ï¼Œæ˜¯å‰ç«¯æ¸²æŸ“çš„èƒ½é‡æ¥æºã€‚

### 2.1 æ•´ä½“ç»“æ„

```json
{
  "translation": "è¿™æ˜¯ä¸€å¥å¾ˆæœ‰æ„æ€çš„è¯ã€‚", // å†—ä½™ä¸€ä»½ä¾¿äºå¤„ç†
  "knowledge": [ ... ],       // æ ¸å¿ƒç”Ÿè¯ä¸çŸ¥è¯†ç‚¹
  "xray": { ... },            // å¥å­ç»“æ„åˆ†æ (X-Ray)
  "companion": { ... },       // æ–‡å­¦/èƒŒæ™¯ä¼´è¯»è¯„æ³¨
  "insight": { ... }          // ç»¼åˆæ´å¯Ÿ (Legacy/Fallback)
}
```

### 2.2 çŸ¥è¯†ç‚¹ (Knowledge Item)

ç”¨äºâ€œåŒé‡æ¼æ–—â€è¿‡æ»¤å’Œç”Ÿè¯å¡ç‰‡æ˜¾ç¤ºã€‚

```json
{
  "key": "unique_id_01",
  "word": "universally",
  "ipa": "/ËŒjuË.nÉªËˆvÉœË.sÉ™l.i/",
  "diff": 3,                  // 1-5 éš¾åº¦
  "def": "adv. æ™®éåœ°ï¼›äººäººçš†çŸ¥åœ°",
  "clue": "Widely, Generally", // è‹±æ–‡çº¿ç´¢/åŒä¹‰è¯
  "context": "universally acknowledged" // åŸæ–‡è¯­å¢ƒ
}
```

### 2.3 å¥å­Xå…‰ (Sentence X-Ray)

```json
{
  "pattern": "so...that ç»“æœçŠ¶è¯­ä»å¥",
  "breakdown": "Mr. Bennet was so odd a mixture...",
  "keyWords": [
    { "word": "so", "role": "ç¨‹åº¦å‰¯è¯" },
    { "word": "that", "role": "è¿è¯" }
  ],
  "explanation": "å¦‚æ­¤...ä»¥è‡³äº... â€”â€” è¡¨ç¤ºå› æœç¨‹åº¦"
}
```

### 2.4 AI ä¼´è¯» (Companion)

```json
{
  "type": "famous_quote",
  "text": "è¿™æ˜¯è‹±å›½æ–‡å­¦å²ä¸Šæœ€è‘—åçš„å¼€ç¯‡ä¹‹ä¸€ã€‚"
}
```

---

## 3. å‰ç«¯ AppContext æ•°æ®å­˜å‚¨

å‰ç«¯é€šè¿‡ `bookData` å¯¹è±¡ç¼“å­˜è¿™äº›æ•°æ®ï¼ŒKey ä¸º `sentence_id`ã€‚

```javascript
bookData: {
  "101": {
    "text": "It is a truth...",
    "translation": "...",
    "knowledge": [...],
    "xray": {...},
    "companion": {...}
  }
}
```

---

## 4. åºŸå¼ƒå­—æ®µ (Deprecated)

*   `ambient_context`: å·²ç§»é™¤ã€‚Flow æ¨¡å¼ä¸å†å°è¯•æ ¹æ®æƒ…æ„Ÿæ”¹å˜èƒŒæ™¯è‰²æˆ–æ˜¾ç¤ºå®ä½“æ’å›¾ã€‚
*   `adaptive_insights`: å·²åˆå¹¶å…¥ `xray` å’Œ `companion`ã€‚
*   `chunks`: å·²ç§»é™¤ã€‚ç›®å‰é‡‡ç”¨æ›´è‡ªç„¶çš„æ®µè½/å¥å­æµå¼å±•ç¤ºã€‚