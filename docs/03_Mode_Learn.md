# 🎓 03_Mode_Learn.md (学习模式)

**定位：** 深度习得 (Acquisition)
**核心隐喻：** X光透视镜 (X-Ray Specs)
**主题色：** Royal Blue (`#2980B9`)
**最后更新：** 2026-02-04

---

## 1. 核心理念 (Philosophy)

**"Desirable Difficulty" (必要的困难)**
Learn 模式不仅是展示知识，更是引导思考。我们利用 **句子X光 (Sentence X-Ray)** 和 **教练问答 (Coach Q&A)**，让用户经历"观察-思考-验证"的过程。

---

## 2. 界面布局 (Layout)

```
┌──────────────────────────────────────────────────────────────────┐
│                        Floating Controls                          │
│                    [Flow] [Learn]  [Lv1] [Lv2] [Lv3]              │
├────────────────────────────────┬─────────────────────────────────┤
│                                │                                  │
│       Reader Panel (60%)       │       Copilot Panel (40%)        │
│                                │                                  │
│   ┌────────────────────────┐   │   ┌──────────────────────────┐   │
│   │ Magnetic Marker        │   │   │ 🔍 句子X光               │   │
│   │   ┌────────────────┐   │   │   │   主语: ...              │   │
│   │   │ Paragraph Text │   │   │   │   谓语: ...              │   │
│   │   │ with keywords  │   │   │   │   结构: ...              │   │
│   │   │ highlighted    │   │   │   └──────────────────────────┘   │
│   │   └────────────────┘   │   │                                  │
│   └────────────────────────┘   │   ┌──────────────────────────┐   │
│                                │   │ 📚 生词脚手架             │   │
│                                │   │   [word] /ipa/ - 释义     │   │
│                                │   │   [word] /ipa/ - 释义     │   │
│                                │   └──────────────────────────┘   │
│                                │                                  │
│                                │   ┌──────────────────────────┐   │
│                                │   │ 🎓 AI 教练               │   │
│                                │   │   [💬 开始问答]           │   │
│                                │   └──────────────────────────┘   │
│                                │                                  │
└────────────────────────────────┴─────────────────────────────────┘
```

---

## 3. 左侧阅读区：Reader Panel

### 3.1 生词交互矩阵

| 等级 | Hover 行为 | 视觉样式 | 实现状态 |
| :--- | :--- | :--- | :--- |
| **Lv 1: Support** | 内联中文标签 | 词后显示灰色释义文字 | ✅ 已实现 |
| **Lv 2: Scaffold** | Tooltip 显示中文释义 | 蓝色底色高亮 | ✅ 已实现 |
| **Lv 3: Challenge** | 无 Tooltip (仅高亮) | 蓝色底色高亮 | ✅ 已实现 |

### 3.2 段落交互

- **Ask AI (✨)**: 点击段落右侧火花图标，打开 AI 对话气泡
- **翻译切换 (译)**: 点击显示/隐藏段落翻译
- **进度追踪**: 自动记录当前阅读位置，跨端同步

---

## 4. 右侧仪表盘：Copilot Panel

### 4.1 句子X光 (Sentence X-Ray) 🆕

**位置：** Copilot Panel 顶部
**触发时机：** 随段落分析自动生成（复用现有 AI 调用）
**设计目的：** 帮助用户理解复杂句子的语法结构

#### 视觉设计

```
┌─────────────────────────────────────┐
│ 🔍 句子X光                           │
├─────────────────────────────────────┤
│ 主语: Mr. Bennet                    │
│ 谓语: was so odd a mixture of...   │
│ 结构: so...that 结果状语从句         │
│                                     │
│ 💡 核心含义                          │
│ "如此...以至于..." —— 表示因果程度   │
└─────────────────────────────────────┘
```

#### 数据结构

```javascript
{
  xray: {
    subject: "Mr. Bennet",
    predicate: "was so odd a mixture of quick parts",
    structure: "so...that 结果状语从句",
    meaning: "如此...以至于... —— 表示因果程度"
  }
}
```

#### 按等级显示逻辑

#### 按等级显示逻辑

| 等级 | 显示内容 |
| :--- | :--- |
| **Lv 1** | **全量显示+解释**：主语 + 谓语 + 结构类型 + 中文核心含义 (帮助理解句意) |
| **Lv 2** | **全量显示**：主语 + 谓语 + 结构类型 + 中文核心含义 (强调结构与含义对应) |
| **Lv 3** | **纯结构显示**：主语 + 谓语 + 结构类型 (**隐藏中文含义**，挑战直接理解) |

**实现状态：** 🟡 设计完成，待开发

---

### 4.2 生词脚手架 (Knowledge Scaffolding)

**位置：** Copilot Panel 中部
**功能：** 显示当前段落的核心生词卡片

#### 苏格拉底循环 (Socratic Loop)

| 状态 | 显示内容 | Lv1 | Lv2 | Lv3 |
| :--- | :--- | :--- | :--- | :--- |
| **Guess** | 单词 + 线索 | 中文提示 | 英文同义词 | 无提示 |
| **Reveal** | 完整释义 | 直接显示 | 直接显示 | 模糊遮罩，点击揭示 |

#### 卡片数据结构

```javascript
{
  word: "sarcastic",
  ipa: "/sɑːˈkæstɪk/",
  clue: "ironic, mocking",     // 英文线索
  def: "adj. 讽刺的，挖苦的",   // 中文释义
  diff: 3,                     // 难度等级
  context: "his sarcastic humour" // 原文上下文
}
```

**实现状态：** ✅ 已实现

---

### 4.3 AI 教练问答 (Coach Q&A) 🆕

**位置：** Copilot Panel 底部
**触发时机：** 用户点击 "开始问答" 按钮
**设计目的：** 用选择题引导用户主动思考，实现苏格拉底式学习

#### 视觉设计

```
┌─────────────────────────────────────┐
│ 🎓 AI 教练问答        [ 💬 开始问答 ] │
├─────────────────────────────────────┤
│                                     │
│  (点击按钮后展开)                     │
│                                     │
│  🤔 Coach:                          │
│  你觉得作者用 "odd mixture" 这个词   │
│  想表达什么?                         │
│                                     │
│  ┌─────────────────────────────┐    │
│  │ A. 奇怪的混合物             │    │
│  └─────────────────────────────┘    │
│  ┌─────────────────────────────┐    │
│  │ B. 性格复杂矛盾  ✓          │    │
│  └─────────────────────────────┘    │
│  ┌─────────────────────────────┐    │
│  │ C. 行为古怪                 │    │
│  └─────────────────────────────┘    │
│                                     │
│  [ 💡 直接告诉我答案 ]               │
│                                     │
└─────────────────────────────────────┘
```

#### 数据结构

```javascript
{
  coachQA: {
    question: "你觉得作者用 'odd mixture' 想表达什么?",
    options: [
      { id: 'A', text: '奇怪的混合物' },
      { id: 'B', text: '性格复杂矛盾' },
      { id: 'C', text: '行为古怪' }
    ],
    correctAnswer: 'B',
    explanation: "作者用 'odd mixture' 暗示 Mr. Bennet 的性格复杂多面..."
  }
}
```

#### 交互规则

1. **触发**: 用户点击 "开始问答" 按钮
2. **请求**: 调用 AI 生成问题 (每段落限 1 次，结果缓存)
3. **答题**: 用户选择选项 或 点击 "直接告诉我答案"
4. **反馈**: 显示正确答案 + 解释

#### Token 节省策略

- **按需调用**: 仅在用户主动点击时请求 AI
- **结果缓存**: 同一段落不重复调用
- **精简 Prompt**: 限制问题数量 (1 道) 和选项数量 (3 个)

**实现状态：** 🟡 设计完成，待开发

---

## 5. 数据联动

### 5.1 用户行为追踪

| 行为 | 记录内容 | 用途 |
| :--- | :--- | :--- |
| 揭示卡片 | `{ word_id, timestamp }` | Review Mode 高优先挖空 |
| 问答答错 | `{ sentence_id, question_id }` | 推荐相似练习 |
| 阅读位置 | `{ paragraph_id }` | 跨端同步进度 |

### 5.2 AI 分析缓存

- 句子分析结果存储在后端 `sentences.analysis_json`
- 教练问答结果存储在 Context (`bookData[id].coachQA`)
- 避免重复调用，节省 Token

---

## 6. 实现清单

| 功能 | 优先级 | 状态 |
| :--- | :--- | :--- |
| 生词高亮 (3 级) | P0 | ✅ 已实现 |
| 生词卡片 (苏格拉底循环) | P0 | ✅ 已实现 |
| 段落翻译 | P0 | ✅ 已实现 |
| Ask AI 对话 | P1 | ✅ 已实现 |
| 阅读进度同步 | P1 | ✅ 已实现 |
| 句子X光 | P2 | 🟡 待开发 |
| AI 教练问答 | P2 | 🟡 待开发 |